#!/bin/sh


#  __        ___    _     _          ____
#  \ \      / / \  | |   | |        |  _ \
#   \ \ /\ / / _ \ | |   | |   _____| | | |
#    \ V  V / ___ \| |___| |__|_____| |_| |
#     \_/\_/_/   \_\_____|_____|    |____/


DIR="$HOME/Pictures/wallpapers/" # Path to wallpapers
Monitor1=$(xrandr --listactivemonitors | grep "+" | awk '{print $4}' | awk NR==1) # Select the first screen for the dual function
Monitor2=$(xrandr --listactivemonitors | grep "+" | awk '{print $4}' | awk NR==2) # Select the second screen if attached for the dual function

# to set same wallpaper on both desktops
Single(){
    walls=$(sxiv -t -o -r -b -g 500x500+500+200 $DIR | xargs)  # running sxiv in thumbnail mode.
    wall1=$(printf "%s" "$walls" | awk '{w = 1; for (--w; w >=0; w--){printf "%s\t",$(NF-w)}print ""}') # Only print the last marked Wallpaper

    # if no picture is marked in sxiv, exit.
    if [ -z "$walls" ]
    then
      exit 0
    else
      $SingleWallMenu
    fi

    SingleWallMenu="dmenu -i -l 5 -p "Options""
    SingleWallOptions=$(echo -e "zoom\ncenter\ntile\nstretch\nno-randr" | $SingleWallMenu)

    xwallpaper --$SingleWallOptions $wall1  && sed -i "s|xwallpaper.*|xwallpaper  --$SingleWallOptions $wall1|" $HOME/.config/Wall-d/defaultwallpaper.sh && wal -i $wall1 -n
}

# to set to diffrent wallpapers on each desktop
Dual() {
    dwalls=$(sxiv -t -o -r -b -g 500x500+500+200 $DIR | xargs)  # running sxiv in thimbnail mode.
    dwallslast2=$(printf "%s" "dwalls" | awk '{w = 2; for (--w; w >=0; w--){printf "%s\t",$(NF-w)}print ""}') # Only print the two last marked Wallpapers
    dwall1=$(printf "%s" "$dwallslast2" | awk '{print $1}')  # Print the path to the before-last marked wallpaper
    dwall2=$(printf "%s" "$dwallslast2" | awk '{print $2}')  # Print the path to the last marked wallpaper

    # if no picture is marked in sxiv, exit.
    if [ -z "$dwalls" ]
    then
      exit 0
    else
      $FirstScreenMenu
    fi

    FirstScreenMenu="dmenu -i -l 4 -p "First_screen_options""
    FirstScreenOptions=$(echo -e "zoom\ncenter\ntile\nstretch" | $FirstScreenMenu)
    SecondScreenMenu="dmenu -i -l 4 -p "Second_screen_options""
    SecondScreenOptions=$(echo -e "zoom\ncenter\ntile\nstretch" | $SecondScreenMenu)

    xwallpaper --output $Monitor1 --$FirstScreenOptions $dwall1 --output $Monitor2 --$SecondScreenOptions $dwall2 && sed -i "s|xwallpaper.*|xwallpaper --output $Monitor1 --$FirstScreenOptions $dwall1 --output $Monitor2 --$SecondScreenOptions $dwall2|" $HOME/.config/Wall-d/defaultwallpaper.sh && wal -i $dwall1 -n
}

MENU="dmenu -l 2 -p "Mode?""
MODE=$(echo -e "Single: Choose one Wallpaper\nDual: Choose two Wallpapers" | $MENU)
  case "$MODE" in
    Single*) Single ;;
    Dual*) Dual
  esac
